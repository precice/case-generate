<?xml version="1.0" encoding="UTF-8" ?>
<precice-configuration>
    <log>
        <sink
                filter="%Severity% > debug"
                format="---[precice] %ColorizedSeverity% %Message%"
                enabled="true"/>
    </log>

    <data:vector name="Forces1"/>
    <data:vector name="Forces2"/>
    <data:vector name="Forces3"/>
    <data:vector name="Displacements1"/>
    <data:vector name="Displacements2"/>
    <data:vector name="Displacements3"/>

    <mesh name="Nastin-Solidz1-Mesh" dimensions="3">
        <use-data name="Forces1"/>
        <use-data name="Displacements1"/>
    </mesh>
    <mesh name="Solidz1-Mesh" dimensions="3">
        <use-data name="Forces1"/>
        <use-data name="Displacements1"/>
    </mesh>
    <mesh name="Nastin-Solidz2-Mesh" dimensions="3">
        <use-data name="Forces2"/>
        <use-data name="Displacements2"/>
    </mesh>
    <mesh name="Solidz2-Mesh" dimensions="3">
        <use-data name="Forces2"/>
        <use-data name="Displacements2"/>
    </mesh>
    <mesh name="Nastin-Solidz3-Mesh" dimensions="3">
        <use-data name="Forces3"/>
        <use-data name="Displacements3"/>
    </mesh>
    <mesh name="Solidz3-Mesh" dimensions="3">
        <use-data name="Forces3"/>
        <use-data name="Displacements3"/>
    </mesh>

    <participant name="Nastin">
        <provide-mesh name="Nastin-Solidz1-Mesh"/>
        <provide-mesh name="Nastin-Solidz2-Mesh"/>
        <provide-mesh name="Nastin-Solidz3-Mesh"/>
        <receive-mesh name="Solidz1-Mesh" from="Nastin"/>
        <receive-mesh name="Solidz2-Mesh" from="Nastin"/>
        <receive-mesh name="Solidz3-Mesh" from="Nastin"/>
        <write-data name="Forces1" mesh="Nastin-Solidz1-Mesh"/>
        <write-data name="Forces2" mesh="Nastin-Solidz2-Mesh"/>
        <write-data name="Forces3" mesh="Nastin-Solidz3-Mesh"/>
        <read-data name="Displacements1" mesh="Nastin-Solidz1-Mesh"/>
        <read-data name="Displacements2" mesh="Nastin-Solidz2-Mesh"/>
        <read-data name="Displacements3" mesh="Nastin-Solidz3-Mesh"/>
        <mapping:nearest-neighbor
                direction="write"
                from="Nastin-Solidz1-Mesh"
                to="Solidz1-Mesh"
                constraint="conservative"
        />
        <mapping:nearest-neighbor
                direction="write"
                from="Nastin-Solidz2-Mesh"
                to="Solidz2-Mesh"
                constraint="conservative"
        />
        <mapping:nearest-neighbor
                direction="write"
                from="Nastin-Solidz3-Mesh"
                to="Solidz3-Mesh"
                constraint="conservative"
        />
    </participant>
    <participant name="Solidz1">
        <provide-mesh name="Solidz1-Mesh"/>
        <receive-mesh name="Nastin-Solidz1-Mesh" from="Solidz1"/>
        <write-data name="Displacements1" mesh="Solidz1-Mesh"/>
        <read-data name="Forces1" mesh="Solidz1-Mesh"/>
        <mapping:nearest-neighbor
                direction="write"
                from="Solidz1-Mesh"
                to="Nastin-Solidz1-Mesh"
                constraint="conservative"
        />
    </participant>
    <participant name="Solidz2">
        <provide-mesh name="Solidz2-Mesh"/>
        <receive-mesh name="Nastin-Solidz2-Mesh" from="Solidz2"/>
        <write-data name="Displacements2" mesh="Solidz2-Mesh"/>
        <read-data name="Forces2" mesh="Solidz2-Mesh"/>
        <mapping:nearest-neighbor
                direction="write"
                from="Solidz2-Mesh"
                to="Nastin-Solidz2-Mesh"
                constraint="conservative"
        />
    </participant>
    <participant name="Solidz3">
        <provide-mesh name="Solidz3-Mesh"/>
        <receive-mesh name="Nastin-Solidz3-Mesh" from="Solidz3"/>
        <write-data name="Displacements3" mesh="Solidz3-Mesh"/>
        <read-data name="Forces3" mesh="Solidz3-Mesh"/>
        <mapping:nearest-neighbor
                direction="write"
                from="Solidz3-Mesh"
                to="Nastin-Solidz3-Mesh"
                constraint="conservative"
        />
    </participant>

    <coupling-scheme:multi>
        <max-time-windows value="10"/>
        <time-window-size value="0.1"/>
        <participant name="Solidz1"/>
        <participant name="Solidz3"/>
        <participant name="Nastin" control="yes"/>
        <participant name="Solidz2"/>
        <exchange data="Forces1" mesh="Solidz1-Mesh" from="Nastin" to="Solidz1"/>
        <exchange data="Forces2" mesh="Solidz2-Mesh" from="Nastin" to="Solidz2"/>
        <exchange data="Forces3" mesh="Solidz3-Mesh" from="Nastin" to="Solidz3"/>
        <exchange data="Displacements1" mesh="Nastin-Solidz1-Mesh" from="Solidz1" to="Nastin"/>
        <exchange data="Displacements2" mesh="Nastin-Solidz2-Mesh" from="Solidz2" to="Nastin"/>
        <exchange data="Displacements3" mesh="Nastin-Solidz3-Mesh" from="Solidz3" to="Nastin"/>
        <acceleration:IQN-ILS>
            <data name="Forces1" mesh="Solidz1-Mesh"/>
            <data name="Forces2" mesh="Solidz2-Mesh"/>
            <data name="Forces3" mesh="Solidz3-Mesh"/>
            <data name="Displacements1" mesh="Nastin-Solidz1-Mesh"/>
            <data name="Displacements2" mesh="Nastin-Solidz2-Mesh"/>
            <data name="Displacements3" mesh="Nastin-Solidz3-Mesh"/>
        </acceleration:IQN-ILS>
        <relative-convergence-measure data="Forces1" mesh="Solidz1-Mesh" limit="0.1"/>
        <relative-convergence-measure data="Forces2" mesh="Solidz2-Mesh" limit="0.1"/>
        <relative-convergence-measure data="Forces3" mesh="Solidz3-Mesh" limit="0.1"/>
        <relative-convergence-measure data="Displacements1" mesh="Nastin-Solidz1-Mesh" limit="0.1"/>
        <relative-convergence-measure data="Displacements2" mesh="Nastin-Solidz2-Mesh" limit="0.1"/>
        <relative-convergence-measure data="Displacements3" mesh="Nastin-Solidz3-Mesh" limit="0.1"/>
    </coupling-scheme:multi>

    <m2n:sockets acceptor="Nastin" connector="Solidz1" directory="."/>
    <m2n:sockets acceptor="Nastin" connector="Solidz2" directory="."/>
    <m2n:sockets acceptor="Nastin" connector="Solidz3" directory="."/>

</precice-configuration>